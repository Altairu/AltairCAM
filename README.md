# AltairCAM

**PCB CNC加工用CAMソフトウェア**

KiCadで設計したPCBをCNCマシンで加工するためのツールパス生成ソフトウェアです。ガーバーファイルとExcellonドリルファイルからGコードを生成します。

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)

## 主な機能

- ✅ **ガーバーファイル解析** - RS-274X形式に対応
- ✅ **Excellonドリルファイル解析** - decimal/integer形式の両対応
- ✅ **3レイヤー管理** - B_Cu（銅箔）、Edge_Cuts（基板外形）、Drill（ドリル穴）を個別管理
- ✅ **ツールパス最適化** - 移動距離を最大60%削減（Nearest Neighbor法）
- ✅ **2Dプレビュー** - ツール直径に基づいた視覚的表示
- ✅ **3Dプレビュー** - 基板を立体表示、回転・ズーム操作可能
- ✅ **切削シミュレーション** - Gコードをアニメーション再生
- ✅ **反転機能** - 裏面加工対応（統一基準点で正確な反転）
- ✅ **個別Gコード生成** - 各レイヤーごとに独立したGコード出力
- ✅ **ヘルプ機能** - 詳細な使い方ガイド付き

## スクリーンショット

*(実際のスクリーンショットは後ほど追加)*

## インストール

### 必要環境

- Python 3.8以上
- pip

### セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/Altairu/AltairCAM.git
cd AltairCAM

# 依存パッケージをインストール
pip install -r requirements.txt

# アプリケーションを起動
python src/main.py
```

## 使い方

### 1. ファイルの準備

KiCadからファイルをエクスポート：

**ガーバーファイル:**
1. PCBエディタ → ファイル → プロット
2. フォーマット: Gerber
3. 含めるレイヤー: B.Cu, Edge.Cuts を選択
4. プロットをクリック

**ドリルファイル:**
1. 同じプロットダイアログで「ドリルファイルの生成」をクリック
2. フォーマット: Excellon
3. 単位: ミリメートル
4. ドリルファイルを生成をクリック

### 2. ファイル読み込み

1. 各ファイルセクション（B_Cu、Edge_Cuts、Drill）で「参照...」をクリック
2. 対応するファイルを選択
3. 「すべて読み込み」をクリック
4. プレビューで確認

### 3. パラメータ設定

各レイヤーごとに設定：

**B_Cu（銅箔アイソレーション）:**
- ツール直径: 0.1-0.2 mm
- 切削深さ: -0.05～-0.1 mm
- 送り速度: 100 mm/min

**Edge_Cuts（基板カット）:**
- ツール直径: 0.8-2.0 mm
- 切削深さ: -1.8 mm（基板厚+余裕）
- 送り速度: 80 mm/min

**Drill（穴あけ）:**
- ツール直径: ドリルビット直径
- 切削深さ: -1.8 mm
- 送り速度: 50 mm/min
- ✅ ツールパス最適化を有効化（推奨）

### 4. Gコード生成

1. 各ファイルセクションの「Gコード生成」ボタンをクリック
2. 保存先を指定
3. CNCマシンで実行

### 5. 推奨加工順序

1. **B_Cu** - 銅箔のアイソレーション
2. **Drill** - 穴あけ
3. **Edge_Cuts** - 基板カット（最後に実行）

## ツールパス最適化

ドリル穴の加工順序を最適化し、移動距離を最小化します。

**実測結果（80穴）:**
- 最適化前: 1087.93 mm
- 最適化後: 452.34 mm
- **改善率: 58.4%**

チェックボックスをONにするだけで自動的に最適化されます。

## 技術スタック

- **言語:** Python 3.8+
- **GUI:** Tkinter
- **プレビュー:** Matplotlib
- **最適化:** Nearest Neighbor法（TSP近似解法）

## プロジェクト構造

```
AltairCAM/
├── src/
│   ├── main.py              # メインアプリケーション
│   ├── core/
│   │   ├── gerber_parser.py # ガーバーパーサー
│   │   ├── excellon_parser.py # Excellonパーサー
│   │   ├── geometry.py      # 幾何データ構造
│   │   ├── mirror.py        # 反転機能
│   │   ├── toolpath.py      # ツールパス生成
│   │   └── optimizer.py     # ツールパス最適化
│   ├── gcode/
│   │   └── generator.py     # Gコード生成
│   └── ui/
│       ├── preview.py       # 2Dプレビュー
│       └── help_dialog.py   # ヘルプダイアログ
├── tests/                   # テストスクリプト
├── sample/                  # サンプルファイル
├── requirements.txt
└── README.md
```

## 貢献

プルリクエストを歓迎します！大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## ライセンス

[MIT License](LICENSE) - 自由に使用、修正、配布できます。

## 作者

- GitHub: [@Altairu](https://github.com/Altairu)

## 謝辞

- FlatCAMプロジェクトからのインスピレーション
- KiCadコミュニティ

## トラブルシューティング

### Q: ドリル穴が1つしか表示されない
A: decimal形式に対応しています。最新版に更新してください。

### Q: 反転時にガーバーとドリルがズレる
A: 統一基準点による反転に対応しています。最新版に更新してください。

### Q: Gコードが生成できない
A: ログウィンドウでエラーメッセージを確認してください。ファイルが正しく読み込まれているか確認してください。

## ロードマップ

- [x] 基本的なガーバー/ドリル解析
- [x] 2Dプレビュー
- [x] ツールパス最適化
- [x] ヘルプ機能
- [x] 3Dプレビュー
- [x] 切削シミュレーション
- [ ] 複数レイヤーの銅箔対応
- [ ] オートレベリング対応
- [ ] 実行可能ファイル(.exe)のビルド

---

**⚠️ 注意:**
このソフトウェアは個人的なプロジェクトです。CNC加工は危険を伴う作業です。生成されたGコードは必ず確認し、ドライラン（空送り）でテストしてから実際の加工を行ってください。
